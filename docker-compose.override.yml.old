services:
  # =====================================
  # TRAEFIK REVERSE PROXY (DEVELOPMENT)
  # =====================================
  traefik:
    image: traefik:v3.0
    container_name: dcprism-traefik-dev
    restart: unless-stopped
    ports:
      - "80:80"      # Port HTTP standard
      - "8088:8080"  # Dashboard Traefik
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
      - ./lumiere/infra/traefik/traefik-dev.yml:/etc/traefik/traefik.yml:ro
    networks:
      - dcprism-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.traefik.rule=Host(`traefik.localhost`)"
      - "traefik.http.routers.traefik.service=api@internal"
      - "traefik.http.services.traefik.loadbalancer.server.port=8080"

  # =====================================
  # APPS - AJOUT DES LABELS TRAEFIK
  # =====================================
  fresnel-app:
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.fresnel.rule=Host(`fresnel.localhost`)"
      - "traefik.http.routers.fresnel.entrypoints=web"
      - "traefik.http.services.fresnel.loadbalancer.server.port=80"

  meniscus-app:
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.meniscus.rule=Host(`meniscus.localhost`)"
      - "traefik.http.routers.meniscus.entrypoints=web"
      - "traefik.http.services.meniscus.loadbalancer.server.port=80"

  # =====================================
  # DEVELOPMENT TOOLS - TRAEFIK ROUTING
  # =====================================
  adminer:
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.adminer.rule=Host(`adminer.localhost`)"
      - "traefik.http.routers.adminer.entrypoints=web"
      - "traefik.http.services.adminer.loadbalancer.server.port=8080"

  redis-commander:
    environment:
      - HTTP_USER=
      - HTTP_PASSWORD=
      - REDIS_COMMANDER_URL_PREFIX=/
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.redis-commander.rule=Host(`redis.localhost`)"
      - "traefik.http.routers.redis-commander.entrypoints=web"
      - "traefik.http.services.redis-commander.loadbalancer.server.port=8081"

  mailpit:
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.mailpit.rule=Host(`mailpit.localhost`)"
      - "traefik.http.routers.mailpit.entrypoints=web"
      - "traefik.http.services.mailpit.loadbalancer.server.port=8025"
